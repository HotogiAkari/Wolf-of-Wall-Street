---

### **最终问题清单与行动计划**

#### **优先级 1：关键 Bug 与功能性错误 (导致程序崩溃、结果错误或核心功能缺失)**

**1. TabTransformer 模型预测时加载失败**
*   **文件**: `main_train.py` (在 `_prophet_load_artifacts` 中) & `model_builders/tabtransformer_builder.py` (在 `train_final_model` 中)
*   **问题**: 预测时加载 TabTransformer 模型失败。原因是 `train_final_model` 在保存元数据时，没有将重建模型所需的关键结构参数（如 `num_continuous`, `dim`, `depth` 等）完整地保存下来。
*   **状态**: **待解决**

**2. 预测图表缺少关键信息 (置信区间 & 涨跌概率)**
*   **文件**: `main_train.py` (在 `_prophet_generate_decision` 中)
*   **问题**: 用户报告预测图表中缺少90%置信区间，并且决策报告中的“上涨/下跌概率”显示为 N/A。这很可能是因为加载的基础模型中不包含LGBM的分位数模型，导致无法计算这些衍生指标。
*   **状态**: **待解决**

**3. 外部市场数据处理不完整**
*   **文件**: `data_process/get_data.py` & `configs/config.yaml`
*   **问题**: `config.yaml` 中 `external_market_tickers` 明确配置了多个外部市场（SPY, QQQ...），但 `get_data.py` 中的代码实现只会下载和处理列表中的**第一个**。这是一个功能性 Bug，导致配置意图未被执行。
*   **状态**: **待解决**

**4. 命令行 `train` 工作流直接崩溃**
*   **文件**: `main_train.py` (在 `if __name__ == '__main__':` 块)
*   **问题**: 在命令行运行 `train` 工作流时，代码引用了未定义的参数 `args.latest`，导致程序启动即报错崩溃。
*   **状态**: **待解决**

**5. TabTransformer 数据处理流程不一致**
*   **文件**: `main_train.py` (在 `run_preprocess_l3_cache` 中) vs `model_builders/tabtransformer_builder.py` (在 `train_final_model` 中)
*   **问题**: 交叉验证阶段的数据处理流程（先标准化后编码）与最终模型训练时的流程（先编码后只对连续特征标准化）不一致。这是一个非常隐蔽但严重的数据不一致问题，会影响模型性能的可靠性。
*   **状态**: **待解决**

**6. `ModelFuser` 的 `load` 方法被重复定义**
*   **文件**: `model_builders/model_fuser.py`
*   **问题**: 文件中存在两个 `load` 方法的定义，后者会覆盖前者。这是一个明显的语法错误，必须修正。
*   **状态**: **待解决**

---

#### **优先级 2：架构不一致与重大风险 (强烈建议修复以保证项目的可维护性和逻辑清晰)**

**7. 存在两套独立的模型融合机制及冲突的配置**
*   **文件**: `model/fusion_strategy.py` vs `model_builders/model_fuser.py` & `configs/config.yaml`
*   **问题**: 项目中存在两套融合逻辑。`fusion_strategy.py` 很可能是已被废弃的历史代码，但 `config.yaml` 的 `strategy_config` 中仍保留着它的参数 (`fusion_ic_span` 等)，与 `fuser_params` 形成冲突和混淆。
*   **状态**: **待解决**

**8. `technical_indicators` 配置在 `config.yaml` 中重复且位置易混淆**
*   **文件**: `configs/config.yaml`
*   **问题**: 文件中存在两个 `technical_indicators` 配置块，一个在顶层，一个在 `strategy_config` 内部。这极易导致用户在错误的位置修改参数，从而使配置不生效。
*   **状态**: **待解决**

**9. 日期计算逻辑在两处重复**
*   **文件**: `main_train.py` vs `data_process/save_data.py`
*   **问题**: 两处存在几乎完全相同的“动态计算 `start_date`”的逻辑，违反了 DRY 原则，是潜在的 bug 源。
*   **状态**: **待解决**

**10. `ModelFuser` 对 LGBM 模型的硬编码依赖**
*   **文件**: `model_builders/model_fuser.py`
*   **问题**: `ModelFuser` 的训练硬编码依赖 `lgbm_oof_preds.csv` 文件来获取真实标签 `y_true`，使得融合模块无法在没有LGBM的场景下独立工作。
*   **状态**: **待解决**

---

#### **优先级 3：代码质量与维护性问题 (建议修复以提升代码质量)**

**11. 脆弱的文件路径依赖**
*   **文件**: `main_train.py`
*   **问题**: 在回测和周期性更新工作流中，通过字符串拼接来硬编码重构L1缓存的文件名，如果上游命名规则改变，会导致功能静默失败。
*   **状态**: **待解决**

**12. 特征计算器的隐式顺序依赖**
*   **文件**: `data_process/feature_calculators.py`
*   **问题**: `ALL_CALCULATORS` 列表的顺序至关重要，但这种依赖是隐式的，容易在未来维护中被无意破坏。
*   **状态**: **待解决**

**13. 股票池中存在重复数据**
*   **文件**: `configs/config.yaml`
*   **问题**: `stocks_to_process` 列表中，`'300242.SZ'` (佳云科技) 出现了两次，应予清理。
*   **状态**: **待解决**

---
