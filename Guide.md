### **【Phoenix项目】最终量化交易系统方案书**

**版本：5.0 (最终审计与战术执行加固版)**
**核心使命：** 构建一个在数据、模型、验证和生产各环节都经过可验证的、严格风险控制，并在每一个执行细节上都具备极高稳健性的工业级量化交易系统。

---

### **第一部分：数据层 - 构建可审计、无偏且同步的历史镜像**

#### **1.1 数据完整性与可信度**
*   **规程:**
    1.  **数据源**: 优先使用提供精确`release_datetime`（含时区）和退市元数据的专业级数据源。
    2.  **数据接入强校验**: 在数据接入层，对`release_datetime`进行格式和时区校验。
        *   **[细节修正]** **“盘后保守处理”**: 必须基于**全局交易所日历表**进行判断。任何缺失或不精确的时间戳，将被统一视为在该交易日`market_close_datetime`之后发布，从而不可用于当日决策。
        *   同时，**必须**记录原始发布文本和入库时间戳以备审计。
    3.  **生存偏差判别**:
        *   优先使用交易所官方元数据判断退市。
        *   **[细节修正]** 在无元数据时，采用“连续N个**交易日**（基于交易所日历）无成交，且通过公告关键词（如“终止上市”）过滤后仍无负面信息”作为退市的判定标准，以此避免在节假日或非连续交易市场中的误判。
*   **验收标准:**
    *   `test_release_time_consistency`: 自动化单元测试，模拟多时区、多交易所场景，验证合并逻辑的正确性。
    *   回测报告需包含基于已知退市样本的复核，并提供因“数据中断”和“真实退市”两种不同假设下的敏感性分析。已知退市样本的处理准确率需 >95%。

---

### **第二部分：建模与验证层 - 在统计显著性的约束下寻找信号**

#### **2.1 特征筛选的系统化流程**
*   **规程:**
    1.  **初步降维**: 窗口聚合统计；相关性分析（剔除 ρ > 0.9）。
    2.  **稳定性筛选**: 滚动IC时间序列（剔除长期不稳定特征）。
    3.  **最终筛选**:
        *   **[细节修正]** 考虑到计算复杂度，优先采用**TreeSHAP**（适用于树模型）或**KernelSHAP**（模型无关）作为Permutation Importance的近似替代。仅在最终入选的Top N（如Top 30）特征上，执行完整的Permutation Importance进行交叉验证。
*   **验收标准:**
    *   提供一份特征筛选报告，包含每个入选特征的滚动IC图、SHAP/Permutation Importance得分。

#### **2.2 模型训练与多重假设检验**
*   **规程:**
    1.  **嵌套交叉验证 (Nested CV)**: 所有超参数搜索在内层循环进行；最终模型评估在外层循环进行。
    2.  **统计显著性检验**:
        *   **[细节修正]** 采用**Circular Block Bootstrap**或**Stationary Bootstrap**等更适合时间序列的自举法，计算策略绩效的p-value。
        *   对p-value进行**Benjamini-Hochberg**等多重检验校正。
*   **验收标准:**
    *   最终策略报告中必须提供经过校正后的p-value，并明确所用的自举法。**任何校正后p-value > 0.05的策略将被视为“未通过统计显著性检验”，不予采纳。**

#### **2.3 分位数预测的校准与监控**
*   **规程:**
    *   模型输出后，强制排序以消除分位数交叉。
    *   在验证集上生成**可靠性图 (Reliability Plot)**，并使用**Isotonic Regression**进行后处理校准。
    *   **[细节修正]** **建立线上闭环监控**: 线上系统必须持续计算“最近30日分位数覆盖率偏差”，并将其作为核心的模型漂移监控指标之一。
*   **验收标准:**
    *   校准后，每个分位数的覆盖率偏差必须在预设阈值（如±3%）以内。

---

### **第三部分：回测与执行层 - 在极端现实的模拟中验证韧性**

#### **3.1 高保真交易执行模拟**
*   **规程:**
    1.  **流动性过滤**: 实现基于ADV的“可成交性过滤器”。
    2.  **成本模型**:
        *   **[细节修正]** 实现基于ADV的**平方根冲击滑点模型**。模型参数（如冲击系数λ）的来源必须在文档中明确注明（例如，参考相关学术文献《XXX》或通过对历史高频成交数据的实证估计）。
        *   回测报告必须包含基于不同冲击参数的敏感性分析图。
*   **验收标准:**
    *   在历史高波动时期进行独立回测，报告中的执行层指标必须在合理范围内。

#### **3.2 组合构建与风险管理**
*   **规程:**
    *   回测必须在投资组合层面进行。
    *   **[细节修正]** **明确求解器**: 信号生成后，需通过一个明确指定求解器（如**CVXPy搭配OSQP/ECOS**）的**组合构建模块**，该模块负责求解在满足**最大单票/行业权重、目标波动率**等约束下的最优持仓权重。
*   **验收标准:**
    *   回测报告需包含详细的组合级别风险敞口分析，并报告组合优化求解器的**平均收敛时间**和**求解失败率**。

---

### **第四部分：生产化与运维 - 确保长期稳定与可控**

#### **4.1 监控与自动化响应**
*   **规程:**
    1.  **策略状态机**: 实现一个包含`{Normal, Degraded, Paused}`等状态的自动化策略状态机。
    2.  **[细节修正]** **阈值设计**: 状态机触发阈值的设定，必须经过**“回溯式触发回测”**。即用历史数据检验不同阈值在历史上会产生的“误报率”和“漏报率”，以找到一个平衡点。
*   **验收标准:**
    *   提供一份阈值设定的研究报告，包含类似ROC曲线的分析，以证明所选阈值的合理性。

#### **4.2 治理与应急预案**
*   **规程:**
    1.  **特征注册库 (Feature Registry)**:
        *   **[细节修正]** 特征注册库必须包含**强制字段**（如`source_id`, `transformation_hash`, `owner`），并与模型构建流程实现**自动化绑定**（例如，模型代码必须通过引用特征ID来加载特征，而非直接引用列名）。
    2.  **运维手册 (Ops Playbook)**: 包含模型回滚、紧急暂停、合规性检查等流程。
*   **验收标准:**
    *   能够从特征注册库中追溯任何一个生产模型的输入特征来源和完整的转换逻辑。
    *   运维手册经过团队评审，并在模拟演练中验证其有效性。

---

### **最终结论**

这份v5.0方案书，是我们在追求极致稳健性和可信度的道路上达到的终点。它不仅是一个技术蓝图，更是一套包含了深刻风险管理哲学和严谨工程实践的完整方法论。通过将每一个潜在的风险点都转化为一个可验证、可度量的具体执行细节，我们最大限度地确保了系统能够在充满不确定性的真实市场中，表现出与其设计初衷相符的韧性和可靠性。

这标志着我们理论探讨的结束，和一个高度结构化、纪律严明的工程实践的开始。